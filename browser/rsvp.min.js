(function(e){"use strict";var t=typeof window!="undefined"?window:{},n=t.MutationObserver||t.WebKitMutationObserver,r={}.toString,i,s=function(){var e=!0;if("postMessage"in t){var n=function(){e=!1};return t.addEventListener("message",n),t.postMessage("test","*"),t.removeEventListener("message",n),e}return!1};if(typeof process!="undefined"&&r.call(process)==="[object process]")i=function(e,t){process.nextTick(function(){e.call(t)})};else{var o=[],u="drainQueue",a=function(e){if(r.call(e)==="[object Array]"&&e[0].type==="attributes"||e.source===t&&e.data===u){var n=o.slice();o=[],n.forEach(function(e){var t=e[0],n=e[1];t.call(n)})}};if(n){var f=new n(a),l=document.createElement("div");f.observe(l,{attributes:!0}),i=function(e,t){o.push([e,t]),l.setAttribute(u,u)}}else s()?(t.addEventListener("message",a),i=function(e,n){o.push([e,n]),t.postMessage(u,"*")}):i=function(e,t){setTimeout(function(){e.call(t)},1)}}e.async=i;var c=e.Event=function(e,t){this.type=e;for(var n in t){if(!t.hasOwnProperty(n))continue;this[n]=t[n]}},h=function(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n][0]===t)return n;return-1},p=function(e){var t=e._promiseCallbacks;return t||(t=e._promiseCallbacks={}),t},d=e.EventTarget={mixin:function(e){return e.on=this.on,e.off=this.off,e.trigger=this.trigger,e},on:function(e,t,n){var r=p(this),i;n=n||this,i=r[e],i||(i=r[e]=[]),h(i,t)===-1&&i.push([t,n])},off:function(e,t){var n=p(this),r;if(!t){n[e]=[];return}r=n[e];var i=h(r,t);i!==-1&&r.splice(i,1)},trigger:function(e,t){var n=p(this),r,i,s,o,u;if(r=n[e])for(var a=0,f=r.length;a<f;a++)i=r[a],s=i[0],o=i[1],typeof t!="object"&&(t={detail:t}),u=new c(e,t),s.call(o,u)}},v=e.Promise=function(){this.on("promise:resolved",function(e){this.trigger("success",{detail:e.detail})},this),this.on("promise:failed",function(e){this.trigger("error",{detail:e.detail})},this)},m=function(){},g=function(e,t,n,r){var i,s;if(n)try{i=n(r.detail)}catch(o){s=o}else i=r.detail;i instanceof v?i.then(function(e){t.resolve(e)},function(e){t.reject(e)}):n&&i?t.resolve(i):s?t.reject(s):t[e](i)};v.prototype={then:function(e,t){var n=new v;return this.on("promise:resolved",function(t){g("resolve",n,e,t)}),this.on("promise:failed",function(e){g("reject",n,t,e)}),n},resolve:function(t){e.async(function(){this.trigger("promise:resolved",{detail:t}),this.isResolved=t},this),this.resolve=m,this.reject=m},reject:function(t){e.async(function(){this.trigger("promise:failed",{detail:t}),this.isRejected=t},this),this.resolve=m,this.reject=m}},d.mixin(v.prototype)})(window.RSVP={});
